"use strict";(globalThis.webpackChunkproton_pass_extension=globalThis.webpackChunkproton_pass_extension||[]).push([["node_modules_jsmimeparser_index_js"],{158:(t,e,r)=>{function s(t){return[t.replace(/=([0-9A-F][0-9A-F]|[ \t]*(\r\n|[\r\n]|$))/gi,function(t,e){return 0==e.trim().length?"":String.fromCharCode(parseInt(e,16))}),""]}function i(t,e){let r=t.replace(/[^A-Za-z0-9+/=]/g,""),s=(r=r.replace(/=+([A-Za-z0-9+/])/g,"$1")).length%4;return t=0!=s&&e?r.slice(-s):"",[atob(r=(r=r.substring(0,r.length-s)).replace(/(====)+$/g,"")),t]}function n(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}function a(t){var e="";for(let r=0;r<t.length;r+=100)e+=String.fromCharCode.apply(void 0,t.subarray(r,r+100));return e}r.r(e),r.d(e,{parseMail:()=>Q});let o=t=>n(atob(t)),h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];class c{constructor(){this.collectInput="",this.decodeString=p}decode(t,e={}){let r=e.stream;return(t&&(this.collectInput+=a(t)),r)?"":this.decodeString(this.collectInput)}}class l extends c{constructor(){super(),this.decodeString=f}}function u(t,e){switch(t.toLowerCase()){case"utf-7":return new c;case"utf-7-imap":return new l;case"cp932":return new TextDecoder("shift_jis",e);default:return new TextDecoder(t,e)}}function d(t){let e=o(t),r="";for(let t=0,s=e.length;t<s;)r+=String.fromCharCode(e[t++]<<8|e[t++]);return r}let p=t=>t.replace(/\+([A-Za-z0-9/]*)-?/gi,(t,e)=>""===e?"+":d(e)),f=t=>t.replace(/&([^-]*)-/g,(t,e)=>""===e?"&":d(e.replace(/,/g,"/")));var _=new Map,g=new Map,y=new Map;function m(t,e,r){var s=t.toLowerCase();_.set(s,e),g.set(s,r),y.set(s,t)}function D(t){let e=this;return t.reduce(function(t,r){return t.concat(e.parseAddressingHeader(r,!0))},[])}function b(t){Array.isArray(t)||(t=[t]),this.addAddresses(t)}function w(t,e,r){return this.parseParameterHeader(t[0],e,r)}function E(t){return this.decodeRFC2047Words(t[0])}function v(t){this.addUnstructured(t)}function T(t){return this.decodeRFC2047Words(t[0])}function C(t){this.addUnstructured(t)}function A(t){return this.parseDateHeader(t[0])}function x(t){this.addDate(t)}function P(t){let e=/<[^>]*>/g,r,s=[];for(;null!==(r=e.exec(t));)s.push(r[0]);return s.join(" ")}m("Bcc",D,b),m("Cc",D,b),m("From",D,b),m("Reply-To",D,b),m("Resent-Bcc",D,b),m("Resent-Cc",D,b),m("Resent-From",D,b),m("Resent-Reply-To",D,b),m("Resent-Sender",D,b),m("Resent-To",D,b),m("Sender",D,b),m("To",D,b),m("Approved",D,b),m("Disposition-Notification-To",D,b),m("Delivered-To",D,b),m("Return-Receipt-To",D,b),m("Mail-Reply-To",D,b),m("Mail-Followup-To",D,b),_.set("Content-Type",function(t){let e=w.call(this,t,!1,!1),r=e.preSemi.split("/");2!=r.length&&(e=new Map,r=["text","plain"]);let s=r[0].toLowerCase(),i=r[1].toLowerCase(),n=s+"/"+i,a=new Map;return a.mediatype=s,a.subtype=i,a.type=n,e.forEach(function(t,e){a.set(e.toLowerCase(),t)}),a}),m("Comments",E,v),m("Keywords",E,v),m("Subject",E,v),m("MIME-Version",E,v),m("Content-Description",E,v),m("User-Agent",E,v),m("Date",A,x),m("Resent-Date",A,x),m("Expires",A,x),m("Injection-Date",A,x),m("NNTP-Posting-Date",A,x),m("Message-ID",T,C),m("Resent-Message-ID",T,C),_.set("Content-Transfer-Encoding",function(t){return t[0].toLowerCase()}),g.set("Content-Transfer-Encoding",v),_.set("References",P),_.set("In-Reply-To",P);let H={};function O(t,e,r){let s,i,n=[];function a(t){this.token=t.replace(/\\(.?)/g,"$1")}a.prototype.toString=function(){return this.token};let o=` 	\r
`,h=0,c=t.length;for(let l=0;l<c;l++){let c=t[l];if("\\"==c){l++;continue}if(void 0!==i){if(c==i&&'"'==c){let e=t.slice(s+1,l);r.rfc2047&&(e=R(e)),n.push(new a(e)),i=void 0,s=void 0}else c==i&&"]"==c&&(n.push(new a(t.slice(s,l+1))),i=void 0,s=void 0);continue}if(r.rfc2047&&"="==c&&l+1<t.length&&"?"==t[l+1]){let e=/([ \t\r\n]*=\?[^?]*\?[BbQq]\?[^?]*\?=)+/.exec(t.slice(l));if(null!==e){void 0!==s&&(n.push(new a(t.slice(s,l))),s=void 0);let r=e[0].length,i=R(t.slice(l,l+r),"UTF-8");n.push({toString:()=>i}),l+=r-1;continue}}let u=!1,d=!1,p=!1;o.includes(c)?u=!0:0==h&&e.includes(c)?(u=!0,p=!0):r.qstring&&'"'==c?(u=!0,d=!0,i=c):r.dliteral&&"["==c?(u=!0,d=!0,i="]"):r.comments&&"("==c?1==++h?(u=!0,p=!0):d=!0:r.comments&&")"==c?(h>0&&h--,0==h?(u=!0,p=!0):d=!0):d=!0,u&&void 0!==s&&(n.push(new a(t.slice(s,l))),s=void 0),p&&n.push(c),d&&void 0===s&&(s=l)}return void 0!==s&&('"'==i?n.push(new a(t.slice(s+1))):n.push(new a(t.slice(s)))),n}function R(t){let e="",r,a=t.split(/(=\?[^?]*\?[BQbq]\?[^?]*\?=)/),o=-1;for(let t=0;t<a.length;t++)"=?"==a[t].substring(0,2)&&(o=t);for(let t=0;t<a.length;t++){if("=?"==a[t].substring(0,2)){let h=function(t,a){let o,h,c=t.split("?");if(5!=c.length||"="!=c[4])return!1;let l=c[1].split("*",1)[0],d=c[2],p=c[3];if("B"==d||"b"==d){if(/[^ A-Za-z0-9+/=]/.exec(p))return!1;o=i(p,!1)[0]}else{if("Q"!=d&&"q"!=d)return!1;o=s(p.replace(/_/g," "),!1)[0]}let f=o;o=n(o);var _="";if(l!=e&&r&&(_+=r.decode(),r=null),e=l,!r)try{r=new u(l,{fatal:!1})}catch(t){return!1}return h=a||"ISO-2022-JP"==l.toUpperCase()&&f.endsWith("\x1b(B")?{stream:!1}:{stream:!0},_+r.decode(o,h)}(a[t],t==o);if(!1!==h){a[t]=h;continue}}else if(/^[ \t\r\n]*$/.exec(a[t])){a[t]="";continue}e="",r&&(a[t]=r.decode()+a[t],r=null)}return a.join("")}function S(t){let e=t.indexOf("'"),r=e>=0?t.indexOf("'",e+1):-1,s=e>=0?t.substring(0,e):"",i=n(t=t.substring(Math.max(e,r)+1));return new u(s,{fatal:!0}).decode(i,{stream:!1})}var M={UT:"+0000",GMT:"+0000",EST:"-0500",EDT:"-0400",CST:"-0600",CDT:"-0500",MST:"-0700",MDT:"-0600",PST:"-0800",PDT:"-0700",AST:"-0400",NST:"-0330",BST:"+0100",MET:"+0100",EET:"+0200",JST:"+0900"},B=new Map,F=new Set;for(let t of _)I(t[0],t[1]),F.add(t[0].toLowerCase());function I(t,e){let r=t.toLowerCase();if(F.has(r))throw Error("Cannot override header: "+t);B.set(r,e),y.has(r)||y.set(r,t)}H.addStructuredDecoder=I,H.convert8BitHeader=function(t,e){if(/[\x80-\xff]/.exec(t)){let r=n(t),s=new u("utf-8",{fatal:e&&!e.toLowerCase().startsWith("utf")});try{t=s.decode(r)}catch(s){try{t=new u(e,{fatal:!1}).decode(r)}catch(t){}}}return t},H.decodeRFC2047Words=R,H.getHeaderTokens=O,H.parseAddressingHeader=function(t,e){void 0===e&&(e=!0);let r=[],s=[],i="",n="",a="",o="",h="",c=!1,l=!1,u=!1,d=!1,p=!1,f=!1,_="";function g(t,e){let r=e.substring(0,e.lastIndexOf("@"));if(null!==/[ !()<>[\]:;@\\,"]/.exec(r)&&(e='"'+r.replace(/([\\"])/g,"\\$1")+'"'+e.substring(e.lastIndexOf("@"))),""===(t=t.replace(/\s+/g," ").trim())&&""!==_){let e=" "===_[0]?2:1;t=_.substr(e,_.length-e-1)}(""!==t||""!==e)&&s.push({name:t,email:e}),i=a=o=_="",c=l=u=d=!1}for(let y of O(t,":,;<>@",{qstring:!0,comments:!0,dliteral:!0,rfc2047:e})){if(":"===y)n=i,i="",a="",s.length>0&&(r=r.concat(s)),s=[];else if("<"!==y||d)if(">"!==y||d)if("("===y)l=!0,p=u,u||(u=""!==i&&" "!==i.substr(-1)),h=u?" (":"(",f=!1;else if(")"===y){l=!1,h+=")",_=h,c?u=p:(i+=h,u=!0),f=!0;continue}else if("@"===y){if(d)continue;c||(o=a,i="",a="",c=!0),o+="@"}else if(","===y)g(i,o),d=!1;else if(";"===y)g(i,o),""===n?r=r.concat(s):r.push({name:n,group:s}),s=[],n="";else{let t=y=y.toString().replace(/[\xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/g," ").replace(/[\u034F\u17B4\u17B5\u180B-\u180D\uFE00-\uFE0F]/g,"").replace(/\uDB40[\uDD00-\uDDEF]/g,"").replace(/(?![\t\n\r])[\0-\x1F\x7F-\x9F]/g,"").replace(/(?:[\xAD\u061C\u06DD\u070F\u08E2\u180E\u200B-\u200F\u202A-\u202E\u2060-\u2064\u2066-\u206F\uFEFF\uFFF9-\uFFFB]|\uD804[\uDCBD\uDCCD]|\uD80D[\uDC30-\uDC38]|\uD82F[\uDCA0-\uDCA3]|\uD834[\uDD73-\uDD7A]|\uDB40[\uDC01\uDC20-\uDC7F])/g," ").replace(/\u2800/g," ");u&&y&&"."!=y[0]&&(t=" "+t),l?h+=t:c?o+=t:(d||(i+=t),f?(a+=y,f=!1):a+=t),u=y&&"."!=y[0];continue}else c=!1,_="",d=!0;else c?(o.length>0&&(i=o),a=o=""):c=!0;u=!1}return g(i,o),""!==n&&(r.push({name:n,group:s}),s=[]),r.concat(s)},H.parseDateHeader=function(t){let e=O(t,",:",{}).map(t=>t.toString());if(e.length>1&&","===e[1]&&(e=e.slice(2)),e.length<8)return new Date(NaN);let r=parseInt(e[0]),s=parseInt(e[2]),i=parseInt(e[3]),n=parseInt(e[5]),a=parseInt(e[7]),o=h.indexOf(e[1].slice(0,3));o<0&&(o=NaN),s<100&&(s+=s<50?2e3:1900);let c=e[8];c in M&&(c=M[c]);let l=/^([+-])(\d\d)(\d\d)$/.exec(c);null===l&&(l=["+0000","+","00","00"]);let u=60*parseInt(l[2])+parseInt(l[3]);return"-"==l[1]&&(u=-u),new Date(Date.UTC(s,o,r,i,n,a)-60*u*1e3)},H.parseParameterHeader=function(t,e,r){let s,i;var n=t.indexOf(";");n<0?(s=t,i=""):(s=t.substring(0,n),i=t.substring(n)),s=s.trim().split(/[ \t\r\n]/)[0];let a="",o=!0,h=[];for(let t of O(i,";=",{qstring:!0,rfc2047:e}))";"===t?(""==a||o||h.push([a,""]),a="",o=!0):"="===t?o=!1:o&&""==a?a=t.toString():o||""==a?o&&(a=""):(t=t.toString(),r&&a.endsWith("*")&&(t=t.replace(/%([0-9A-Fa-f]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))})),h.push([a,t]),a="");""==a||o||h.push([a,""]);var c=new Map,l=new Map,u=new Map;for(let t of h){let e=t[0],r=t[1],s=e.indexOf("*");if(-1==s)c.has(e)||c.set(e,r);else if(s==e.length-1)e=e.substring(0,s),l.has(e)||l.set(e,r);else{let t=e.substring(0,s),i=u.get(t);if(u.has(t)&&!i.valid)continue;u.has(t)||((i=[]).valid=!0,i.hasCharset=void 0,u.set(t,i));let n="*"==e[e.length-1],a=e.substring(s+1,e.length-+!!n);if("0"==a)i.hasCharset=n;else if(0==a.length||"0"==a[0]&&"0"!=a||!/^[0-9]+$/.test(a)){i.valid=!1;continue}if(void 0!==i[a=parseInt(a,10)]){i.valid=!1;continue}i[a]=r}}var d=new Map;for(let t of c)d.set(t[0],t[1]);if(r){for(let t of u){let e=t[0],r=t[1];if(void 0===r.hasCharset)continue;let s=!0;for(var p=0;s&&p<r.length;p++)void 0===r[p]&&(s=!1);let i=r.slice(0,p).join("");if(r.hasCharset)try{i=S(i)}catch(t){continue}d.set(e,i)}for(let t of l)try{d.set(t[0],S(t[1]))}catch(t){}}return d.preSemi=s,d},H.parseStructuredHeader=function(t,e){if(("string"==typeof e||e instanceof String)&&(e=[e]),!Array.isArray(e))throw TypeError("Header value is not an array: "+e);let r=t.toLowerCase();if(B.has(r))return B.get(r).call(H,e);throw Error("Unknown structured header: "+t)};let N=Object.freeze(H);function j(t,e){let r=t.split(/(?:\r\n|\n)(?![ \t])|\r(?![ \t\n])/);r.length>0&&"From "==r[0].substring(0,5)&&(r.shift(),t=0==r.length?"":t.substring(t.indexOf(r[0])));let s=new Map;for(let t=0;t<r.length;t++){let i,n,a=r[t].indexOf(":");a>=0?(i=r[t].substring(0,a),n=r[t].substring(a+1).trim(),e.stripcontinuations&&(n=n.replace(/[\r\n]/g,""))):(i=r[t],n=""),""!=(i=i.trim().toLowerCase())&&(s.has(i)?s.get(i).push(n):s.set(i,[n]))}this._rawHeaders=s,this._cachedHeaders=new Map,Object.defineProperty(this,"rawHeaderText",{get:()=>t}),Object.defineProperty(this,"size",{get(){return this._rawHeaders.size}}),Object.defineProperty(this,"charset",{get(){return this._charset},set(t){this._charset=t,this._cachedHeaders.clear()}}),"charset"in e?this._charset=e.charset:this._charset=null,Object.defineProperty(this,"contentType",{configurable:!0,get(){return this.get("Content-Type")}})}j.prototype.getRawHeader=function(t){return this._rawHeaders.get(t.toLowerCase())},j.prototype.get=function(t){let e;if(t=t.toLowerCase(),this._cachedHeaders.has(t))return this._cachedHeaders.get(t);let r=this._rawHeaders.get(t);if(void 0===r)return r;let s=this.charset;r=r.map(function(t){return N.convert8BitHeader(t,s)});try{e=N.parseStructuredHeader(t,r)}catch(t){e=r.map(function(t){return N.decodeRFC2047Words(t)})}return this._cachedHeaders.set(t,e),e},j.prototype.has=function(t){return this._rawHeaders.has(t.toLowerCase())};var L="function"==typeof Symbol?Symbol.iterator:"@@iterator";function U(t,e){if(this._emitter=t,this._options={pruneat:"",bodyformat:"nodecode",strformat:"binarystring",stripcontinuations:!0,charset:"","force-charset":!1,onerror:()=>{}},e)for(var r in e)this._options[r]=e[r];if("function"!=typeof this._options.onerror)throw Error("onerror callback must be a function");this.resetParser()}function k(t){let e=t.lastIndexOf("\r",t.length-2),r=t.lastIndexOf(`
`),s=r>e?r:e;return[t.substring(0,s+1),t.substring(s+1)]}j.prototype[L]=function*(){for(let t of this.keys())yield[t,this.get(t)]},j.prototype.forEach=function(t,e){for(let[r,s]of this)t.call(e,s,r,this)},j.prototype.entries=j.prototype[Symbol.iterator],j.prototype.keys=function*(){for(let t of this._rawHeaders.keys())yield y.get(t)||t.replace(/\b[a-z]/g,function(t){return t.toUpperCase()})},j.prototype.values=function*(){for(let[,t]of this)yield t},U.prototype.resetParser=function(){this._state=W,this._holdData="",this._headerData="",this._triggeredCall=!1,this._splitRegex=this._handleSplit=void 0,this._subparser=this._subPartNum=void 0,this._savedBuffer="",this._convertData=void 0,this._decoder=void 0},U.prototype.deliverData=function(t){this._holdData&&(t=this._holdData+t,this._holdData=""),t.length>0&&([t,this._holdData]=k(t)),0!=t.length&&(this._triggeredCall||(this._callEmitter("startMessage"),this._triggeredCall=!0),this._dispatchData("",t,!0))},U.prototype.deliverEOF=function(){this._triggeredCall||(this._triggeredCall=!0,this._callEmitter("startMessage")),this._holdData&&this._dispatchData("",this._holdData,!0),this._dispatchEOF(""),this._callEmitter("endMessage")},U.prototype._callEmitter=function(t,...e){if(this._emitter&&t in this._emitter&&!(e.length>0&&this._willIgnorePart(e[0])))try{this._emitter[t].apply(this._emitter,e)}catch(t){this._options.onerror(t)}},U.prototype._willIgnorePart=function(t){if(this._options.pruneat){let e=this._options.pruneat;if(t.substr(0,e.length)!=e||e.length<t.length&&!"$.".includes(t[e.length]))return!0}return!1};var W=1;U.prototype._dispatchData=function(t,e,r){if(this._state==W){this._headerData+=e;let r=/(?:^(?:\r\n|[\r\n]))|(\r\n|[\r\n])\1/.exec(this._headerData);if(null==r)return;{let s=this._headerData.substr(0,r.index);e=this._headerData.substring(r.index+r[0].length),this._headerData=s,this._headers=this._parseHeaders(),this._callEmitter("startPart",t,this._headers),this._startBody(t)}}if(r&&this._splitRegex){let r=this._splitRegex.exec(e);if(r){let s=r.index,i=r[0].length;s>0&&this._dispatchData(t,e.substr(0,s),!1),this._handleSplit(t,r),(e=e.substring(s+i)).length>0&&this._dispatchData(t,e,!0);return}}if(2==this._state);else if(3==this._state){if("none"==this._options.bodyformat||this._willIgnorePart(t))return;let{coerced:r,raw:s}=this._applyDataConversion(e,this._options.strformat);this._callEmitter("deliverPartData",t,r,s)}else if(4==this._state){let{coerced:t}=this._applyDataConversion(e,"binarystring");e.length>0&&this._subparser._dispatchData(this._subPartNum,t,!0)}},U.prototype._applyDataConversion=function(t,e){return this._convertData&&(t=this._savedBuffer+t,[t,this._savedBuffer]=this._convertData(t,!0)),{coerced:this._coerceData(t,e,!1),raw:t instanceof Uint8Array?t:n(t)}},U.prototype._coerceData=function(t,e,r){if("string"==typeof t){if("binarystring"==e)return t;var s=n(t);return"unicode"==e?this._coerceData(s,"unicode",r):s}if("binarystring"==e)return a(t);if("unicode"==e)return this._decoder?this._decoder.decode(t,{stream:r}):t;throw Error("Invalid type: "+e)},U.prototype._dispatchEOF=function(t){if(this._state==W)this._headers=this._parseHeaders(),this._callEmitter("startPart",t,this._headers);else if(4==this._state)this._convertData&&this._savedBuffer&&this._subparser._dispatchData(this._subPartNum,this._convertData(this._savedBuffer,!1)[0],!0),this._subparser._dispatchEOF(this._subPartNum),this._subparser=null;else if(this._convertData&&this._savedBuffer){let[e]=this._convertData(this._savedBuffer,!1);(e=this._coerceData(e,this._options.strformat,!1)).length>0&&this._callEmitter("deliverPartData",t,e)}this._callEmitter("endPart",t)},U.prototype._parseHeaders=function(){let t=new j(this._headerData,this._options),e=t.get("Content-Type");void 0===e?(e=N.parseStructuredHeader("Content-Type",this._defaultContentType||"text/plain"),Object.defineProperty(t,"contentType",{get:()=>e})):Object.defineProperty(t,"contentType",{configurable:!1});let r="";return t.charset=r=this._options["force-charset"]?this._options.charset:e.has("charset")?e.get("charset"):this._options.charset,this._charset=r,t},U.prototype._startBody=function(t){let e=this._headers.contentType;if("raw"==this._options.bodyformat&&t==this._options.pruneat){this._state=3;return}if("multipart"==e.mediatype){if(!e.has("boundary")){this._state=2;return}this._splitRegex=RegExp(`(\r
|[\r
]|^)--`+e.get("boundary").replace(/[\\^$*+?.()|{}[\]]/g,"\\$&")+`(--)?[ 	]*(?:\r
|[\r
]|$)`),this._handleSplit=this._whenMultipart,this._subparser=new U(this._emitter,this._options),"digest"==e.subtype&&(this._subparser._defaultContentType="message/rfc822"),this._state=2,this._convertData=function(t,e){let r=t.length;e&&(`
`==t.charAt(r-1)&&r--,r>=0&&"\r"==t.charAt(r-1)&&r--);let s=k(t.substring(0,r));return[s[0],s[1]+t.substring(r)]}}else if("message/rfc822"==e.type||"message/global"==e.type||"message/news"==e.type){this._state=4,this._subPartNum=t+"$",this._subparser=new U(this._emitter,this._options);let e=this._extractHeader("content-transfer-encoding","");e in z&&(this._convertData=z[e])}else if(this._state=3,"decode"==this._options.bodyformat){let t=this._extractHeader("content-transfer-encoding","");t in z&&(this._convertData=z[t])}if("unicode"==this._options.strformat&&"text"==e.mediatype){if(this._decoder=null,""!==this._charset)try{this._decoder=new u(this._charset)}catch(t){console.error(t)}this._decoder||(this._decoder={decode:t=>U.prototype._coerceData(t,"binarystring",!0)})}else this._decoder=null},U.prototype._whenMultipart=function(t,e){if(""!=t&&(t+="."),this._subPartNum){if(""!=this._savedBuffer&&""===e[1]){let t=this._savedBuffer.length-1;`
`==this._savedBuffer[t]&&t--,t>=0&&"\r"==this._savedBuffer[t]&&t--,this._savedBuffer=this._savedBuffer.substring(0,t+1)}""!=this._savedBuffer&&this._subparser._dispatchData(this._subPartNum,this._savedBuffer,!0),this._subparser._dispatchEOF(this._subPartNum)}else this._count=1;this._savedBuffer="",void 0==e[2]?(this._subparser.resetParser(),this._state=4,this._subPartNum=t+this._count,this._count+=1):(this._splitRegex=null,this._state=2)},U.prototype._extractHeader=function(t,e){return t=t.toLowerCase(),this._headers.has(t)?this._headers.get(t):N.parseStructuredHeader(t,[e])};var z={};z["quoted-printable"]=s,z.base64=i;var $={getAttachmentName(t){if(!t||!t.headers)return"";if(t.headers["content-disposition"]){let e=Z.getParameter(t.headers["content-disposition"][0],"filename");if(e)return e}if(t.headers["content-type"]){let e=Z.getParameter(t.headers["content-type"][0],"name");if(e)return e}return""},isAttachment(t){if(!t)return!1;let e=t.contentType||"text/plain";if(0===e.search(/^multipart\//i))return!1;let r="";return Array.isArray(t.headers["content-disposition"])&&t.headers["content-disposition"].length>0&&(r=t.headers["content-disposition"][0]),0===r.search(/^attachment/i)||-1===e.search(/^text\/plain|^text\/html|^text\/enriched/i)},startMessage(){this.mimeTree={partName:"",contentType:"message/rfc822",parts:[],size:0,headers:{},rawHeaderText:"",allAttachments:[],bodyParts:{text:[],html:[]},isEncrypted:!1},this.partsPath=[this.mimeTree],this.options=this.options||{}},endMessage(){if(this.mimeMsg=null,0!=this.mimeTree.parts.length){if(this.options.getMimePart){this.mimeTree.parts[0].partName==this.options.getMimePart&&(this.mimeMsg=this.mimeTree.parts[0],this.mimeMsg.bodyAsTypedArray=n(this.mimeMsg.body));return}this.mimeMsg=this.mimeTree}},startPart(t,e){let r=new TextEncoder,s=e.contentType&&e.contentType.type?e.contentType.type:"text/plain",i=e.rawHeaderText,n={};for(let[t,s]of e._rawHeaders){let e=Array.isArray(s)?s:[s];n[t]=e.map(t=>a(r.encode(t)))}let o=this.partsPath[this.partsPath.length-1],h="1"+(""!==t?".":"")+t;"1"==h&&(o.rawHeaderText=i,i=i.split(/\n(?![ \t])/).filter(t=>t.toLowerCase().startsWith("content-")).join(`
`).trim(),o.headers=n,n=Object.fromEntries(Object.entries(n).filter(t=>t[0].startsWith("content-")))),n["content-type"]||(n["content-type"]=["text/plain"]);let c={partName:h,rawBody:null,body:"",headers:n,rawHeaderText:i,contentType:s,size:0,parts:[],isEncrypted:!1};o.parts.push(c),this.partsPath.push(c)},endPart(t){let e=!1,r=this.partsPath[this.partsPath.length-1],s=r.body.length;if(r.size+=s,this.isAttachment(r)){r.fileName=this.getAttachmentName(r);let t=r.headers["content-disposition"]&&r.headers["content-disposition"][0],s=r.headers["content-id"]&&r.headers["content-id"][0];r.contentDisposition=t?t.split(";").shift():void 0,r.contentId=s||void 0,this.options.includeAttachments?this.mimeTree.allAttachments.push(r):e=!0}else if(r.rawBody)switch(delete r.rawBody,r.contentType||"text/plain"){case"text/html":this.mimeTree.bodyParts.html.push(r.body);break;case"text/plain":this.mimeTree.bodyParts.text.push(r.body)}e&&(delete r.body,delete r.rawBody),r.headers=Object.fromEntries(Object.entries(r.headers).filter(t=>!["content-disposition","content-transfer-encoding"].includes(t[0]))),this.partsPath.pop(),r=this.partsPath[this.partsPath.length-1],r.size+=s},deliverPartData(t,e,r){let s=this.partsPath[this.partsPath.length-1];"string"==typeof e?s.body+=e:s.body+=a(e),null===s.rawBody?s.rawBody=r:s.rawBody=function(t){if(1===t.length)return t[0];let e=0;for(let r=0;r<t.length;r++){if(!(t[r]instanceof Uint8Array))throw Error("concatArrays: Data must be in the form of a Uint8Array");e+=t[r].length}let r=new Uint8Array(e),s=0;return t.forEach(t=>{r.set(t,s),s+=t.length}),r}([s.rawBody,r])}},q={startPart(t,e){""==t&&(this.headers=e)}},J={body:"",startPart:q.startPart,deliverPartData(t,e){""==t&&(this.body+=e)}};let Z={getParameter(t,e){for(let[r,s]of(e=e.toLowerCase(),t=t.replace(/[\r\n]+[ \t]+/g,""),N.parseParameterHeader(";"+t,!0,!0).entries()))if(e==r.toLowerCase())return s;return""},parseSync(t,e,r){if("string"!=typeof t)throw Error("input is not a recognizable type!");var s=new U(e,r);s.deliverData(t),s.deliverEOF()},makeParser:(t,e)=>new U(t,e),extractMimeMsg(t,e={}){var r=Object.create($);for(let t of(r.options={includeAttachments:!0,getMimePart:""},Object.keys(e)))r.options[t]=e[t];return Z.parseSync(t,r,{pruneat:r.options.getMimePart.split(".").slice(1).join("."),bodyformat:"decode",stripcontinuations:!0,strformat:"unicode"}),r.mimeMsg},extractHeaders(t){var e=Object.create(q);return Z.parseSync(t,e,{pruneat:"",bodyformat:"none"}),e.headers},extractHeadersAndBody(t){var e=Object.create(J);return Z.parseSync(t,e,{pruneat:"",bodyformat:"raw"}),[e.headers,e.body]},HEADER_UNSTRUCTURED:0,HEADER_PARAMETER:2,HEADER_ADDRESS:3,HEADER_OPTION_DECODE_2231:16,HEADER_OPTION_DECODE_2047:32,HEADER_OPTION_ALLOW_RAW:64,HEADER_OPTION_ALL_I18N:112,parseHeaderField(t,e,r){switch(e&Z.HEADER_OPTION_ALLOW_RAW&&(t=N.convert8BitHeader(t,r)),15&e){case Z.HEADER_UNSTRUCTURED:return e&Z.HEADER_OPTION_DECODE_2047&&(t=N.decodeRFC2047Words(t)),t;case Z.HEADER_PARAMETER:return N.parseParameterHeader(t,(e&Z.HEADER_OPTION_DECODE_2047)!=0,(e&Z.HEADER_OPTION_DECODE_2231)!=0);case Z.HEADER_ADDRESS:return N.parseAddressingHeader(t,(e&Z.HEADER_OPTION_DECODE_2047)!=0);default:throw Error("Illegal type of header field")}}};function Q(t){let e="string"==typeof t?new TextEncoder().encode(t):t,{headers:r,allAttachments:s,bodyParts:i}=Z.extractMimeMsg(a(e)),n=new Set(["message-id","content-id","from","sender","in-reply-to","reply-to","subject","date","content-disposition","content-type","content-transfer-encoding","priority","mime-version","content-description","precedence","errors-to"]),o={headers:r,attachments:s.map(({parts:t,partName:e,body:r,isEncrypted:s,rawBody:i,...n})=>({...n,content:i||new Uint8Array})),body:{html:i.html.length?i.html.join(`<br>
`).replace(/\r?\n/g,`
`):null,text:i.text.length?i.text.join(`
`).replace(/\r?\n/g,`
`):null}};return["subject","date","to","from","to","cc","bcc","message-id","in-reply-to","reply-to"].forEach(t=>{if(!r[t])return;let e=r[t]&&N.parseStructuredHeader(t,r[t]);o[t]=n.has(t)&&Array.isArray(e)?e[e.length-1]:e}),o}}}]);
